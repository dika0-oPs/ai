<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ansain AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        :root { --primary: #7c4dff; --bg-img: url('https://i.ibb.co.com/fdyCcG4K/6674bee4254f31a82db367db2c89ed0f.jpg'); }
        .dark-ansain-mode { --primary: #ff0000; }
        .white-ansain-mode { --primary: #00e5ff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #0b0b0b; color: #f9fafb; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .main-bg { position: fixed; inset: 0; z-index: 0; background-image: var(--bg-img); background-size: cover; background-position: center; filter: brightness(0.4) contrast(1.1); transition: 0.5s; }
        header, main, footer, .mode-bar { position: relative; z-index: 10; }
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; scrollbar-width: none; }
        .bubble-ai { align-self: flex-start; max-width: 92%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 16px; border-radius: 20px 20px 20px 5px; font-size: 0.95rem; line-height: 1.6; color: #f3f4f6; backdrop-filter: blur(12px); animation: fadeInUp 0.4s ease-out; position: relative; }
        .bubble-user { align-self: flex-end; max-width: 85%; background: linear-gradient(135deg, var(--primary), #6366f1); padding: 12px 18px; border-radius: 20px 20px 5px 20px; font-size: 0.95rem; font-weight: 600; color: white; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); animation: fadeInUp 0.4s ease-out; }
        .code-wrapper { position: relative; margin: 15px 0; background: #0d0d0d; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); overflow: hidden; opacity: 0; transform: translateY(10px); animation: codeSlide 0.5s forwards; }
        @keyframes codeSlide { to { opacity: 1; transform: translateY(0); } }
        .code-header { background: rgba(255, 255, 255, 0.05); padding: 10px 14px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .code-header div { display: flex; align-items: center; gap: 8px; }
        .code-header i { font-size: 14px; color: var(--primary); }
        .code-header span { font-size: 10px; font-weight: 800; color: rgba(255, 255, 255, 0.5); text-transform: uppercase; letter-spacing: 1px; }
        pre { padding: 15px; overflow-x: auto; font-family: 'Consolas', monospace; font-size: 13px; color: #00e5ff; line-height: 1.5; white-space: pre; margin-bottom: 40px; }
        .copy-btn-container { position: absolute; bottom: 8px; right: 8px; }
        .copy-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 6px 12px; border-radius: 8px; font-size: 10px; color: #fff; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: 0.2s; backdrop-filter: blur(10px); }
        .mode-bar { display: flex; gap: 8px; padding: 12px 20px; overflow-x: auto; scrollbar-width: none; background: rgba(0, 0, 0, 0.5); }
        .mode-opt { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 10px 18px; border-radius: 12px; font-size: 10px; font-weight: 800; white-space: nowrap; color: #9ca3af; transition: 0.3s; }
        .mode-opt.active { background: rgba(255, 255, 255, 0.1); border-color: var(--primary); color: white; }
        .input-area { padding: 10px 20px 30px; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(20px); }
        .input-card { background: rgba(255, 255, 255, 0.07); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 5px 10px 5px 15px; display: flex; align-items: center; gap: 10px; }
        textarea { background: transparent; border: none; outline: none; color: white; flex: 1; resize: none; max-height: 120px; font-size: 0.95rem; padding: 10px 0; }
        .btn-send { background: var(--primary); width: 40px; height: 40px; border-radius: 14px; display: flex; align-items: center; justify-content: center; color: white; }
        
        #sidebar { position: fixed; top: 0; left: -300px; width: 300px; height: 100%; background: rgba(10, 10, 10, 0.98); backdrop-filter: blur(30px); z-index: 5000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); border-right: 1px solid rgba(255, 255, 255, 0.1); }
        #sidebar.active { left: 0; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 4999; display: none; }
        .history-item { padding: 14px; border-radius: 14px; background: rgba(255,255,255,0.03); margin-bottom: 10px; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.05); }
        .history-item:hover { background: rgba(255,255,255,0.08); border-color: var(--primary); }
        .history-item.active { background: var(--primary); border-color: var(--primary); }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 4s linear infinite; }
    </style>
</head>
<body>
    <div class="main-bg"></div>
    
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div id="sidebar" class="flex flex-col p-6">
        <div class="flex items-center gap-4 mb-8 pb-6 border-b border-white/10">
            <img src="https://i.ibb.co.com/zVykFCrG/wkcfhd.jpg" class="w-12 h-12 rounded-2xl border border-white/20">
            <div>
                <h3 id="sideUserName" class="text-lg font-black text-white uppercase italic tracking-tighter">USER</h3>
                <p class="text-[9px] font-bold text-purple-400 tracking-widest uppercase">Verified Access</p>
            </div>
        </div>
        
        <button onclick="createNewChat()" class="w-full p-4 rounded-xl bg-purple-600 text-white text-[10px] font-black uppercase tracking-widest mb-6 flex items-center justify-center gap-2 active:scale-95 transition shadow-lg shadow-purple-900/20">
            <i class="fa-solid fa-plus"></i> New Chat
        </button>

        <div class="flex-1 overflow-y-auto scrollbar-none">
            <p class="text-[10px] font-black text-white/40 uppercase tracking-widest mb-4">Recent Sessions</p>
            <div id="historyList"></div>
        </div>

        <div class="mt-auto pt-6 space-y-3">
            <button onclick="clearAllHistory()" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-[10px] font-bold text-white uppercase tracking-widest flex items-center gap-3 hover:bg-red-500/10 hover:border-red-500/30 transition">
                <i class="fa-solid fa-trash-can text-red-500"></i> Delete All
            </button>
            <button onclick="logout()" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-[10px] font-bold text-white uppercase tracking-widest flex items-center gap-3 hover:bg-white/10 transition">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </button>
        </div>
    </div>

    <div id="onboarding" class="fixed inset-0 bg-black z-[1000] flex flex-col items-center justify-center" style="display:none">
        <div class="p-8 text-center space-y-6 w-full max-w-sm">
            <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Ansain Access</h2>
            <div class="space-y-4">
                <input type="text" id="userInputLogin" class="w-full bg-white/10 border border-white/20 p-5 rounded-2xl text-center text-white outline-none focus:border-purple-500 font-bold" placeholder="Username">
                <input type="password" id="passInputLogin" class="w-full bg-white/10 border border-white/20 p-5 rounded-2xl text-center text-white outline-none focus:border-purple-500 font-bold" placeholder="Password">
            </div>
            <button onclick="loginSystem()" id="loginBtn" class="w-full bg-purple-600 text-white p-5 rounded-2xl font-black uppercase tracking-widest active:scale-95 transition">Masuk Sistem</button>
            <p id="loginError" class="text-red-500 text-[10px] font-black uppercase hidden">Akses Ditolak!</p>
        </div>
    </div>

    <div id="modeTransition" class="fixed inset-0 bg-black/95 backdrop-blur-3xl z-[2000] hidden flex-col items-center justify-center">
        <div class="text-center">
            <div class="w-20 h-20 bg-white/5 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-white/10">
                <i id="modeIcon" class="fa-solid fa-bolt text-4xl text-white"></i>
            </div>
            <h2 id="modeTitle" class="text-2xl font-black text-white tracking-tighter uppercase"></h2>
        </div>
    </div>

    <header>
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()" class="w-10 h-10 bg-white/5 border border-white/10 rounded-xl flex items-center justify-center text-white active:scale-90 transition">
                <i class="fa-solid fa-bars-staggered"></i>
            </button>
            <div>
                <div class="flex items-center gap-2">
                    <h1 class="text-sm font-black text-white uppercase">ANSAIN AI</h1>
                    <span id="digitalClock" class="text-[9px] font-mono font-bold text-white/40 bg-white/5 px-2 py-0.5 rounded border border-white/5">00:00:00</span>
                </div>
                <p id="labelMode" class="text-[8px] font-bold text-purple-400 uppercase tracking-widest">CONNECTED</p>
            </div>
        </div>
        <img id="headerAvatar" src="https://i.ibb.co.com/zVykFCrG/wkcfhd.jpg" class="w-10 h-10 rounded-xl object-cover border border-white/20">
    </header>

    <main id="chatDisplay" class="chat-container"></main>

    <div id="typingIndicator" class="hidden px-6 py-4">
        <div class="flex items-center gap-2 text-white/30 font-bold text-[9px] uppercase tracking-widest"><div class="w-2 h-2 bg-white/30 rounded-full animate-bounce"></div> Syncing...</div>
    </div>

    <div class="mode-bar">
        <div onclick="setMode('biasa')" class="mode-opt" id="m-biasa">BIASA</div>
        <div onclick="setMode('konten')" class="mode-opt" id="m-konten">KONTEN</div>
        <div onclick="setMode('ngoding')" class="mode-opt" id="m-ngoding">NGODING</div>
        <div onclick="setMode('white')" class="mode-opt" id="m-white">WHITE</div>
        <div onclick="setDarkAnsain()" class="mode-opt" id="m-dark">DARK</div>
    </div>

    <footer class="input-area">
        <div id="musicPlayerContainer" class="mb-3 px-3 py-2 flex items-center justify-between bg-white/5 rounded-xl border border-white/10 backdrop-blur-md">
            <div class="flex items-center gap-3 overflow-hidden">
                <div class="w-8 h-8 bg-purple-600/20 rounded-lg flex items-center justify-center border border-purple-500/30">
                    <i id="musicIcon" class="fa-solid fa-compact-disc text-purple-400"></i>
                </div>
                <div class="overflow-hidden">
                    <p class="text-[8px] font-black text-purple-400 uppercase tracking-widest">Stream Active</p>
                    <p id="songTitle" class="text-[10px] font-bold text-white truncate italic">Ready</p>
                </div>
            </div>
            <button onclick="toggleMusic()" class="w-8 h-8 flex items-center justify-center bg-white/10 rounded-full text-white active:scale-90 transition">
                <i id="playBtnIcon" class="fa-solid fa-play text-[10px]"></i>
            </button>
        </div>
        <div class="input-card">
            <textarea id="userInput" rows="1" placeholder="Kirim pesan..." oninput="autoResize(this)"></textarea>
            <button onclick="handleProcess()" class="btn-send"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </footer>

    <script>
        const keys = ["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", "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", "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"];
        
        let config = JSON.parse(localStorage.getItem('ansain_config')) || { name: '', mode: 'biasa' };
        let chatSessions = JSON.parse(localStorage.getItem('ansain_sessions')) || [];
        let currentSessionId = localStorage.getItem('ansain_current_session') || null;
        let memory = [];
        let currentTrack = new Audio();
        let isTyping = false;

        const playlist = [
            { name: "PACARKU DITIKUNG TEMEN", url: "https://semantic-teal-t3tdavv7gs.edgeone.app/pacarkuditikungtemen.mp3" },
            { name: "LOFI STUDY", url: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Ketsa/Raising_Frequencies/Ketsa_-_09_-_Interlude.mp3" }
        ];
        const ngodingSong = { name: "PACARKU DITIKUNG TEMEN", url: "https://semantic-teal-t3tdavv7gs.edgeone.app/pacarkuditikungtemen.mp3" };

        function updateClock() {
            const now = new Date();
            document.getElementById('digitalClock').innerText = now.toLocaleTimeString('en-GB');
        }
        setInterval(updateClock, 1000); updateClock();

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isOpen = sb.classList.contains('active');
            if(isOpen) {
                sb.classList.remove('active');
                overlay.style.display = 'none';
            } else {
                renderHistoryList();
                sb.classList.add('active');
                overlay.style.display = 'block';
            }
        }

        function createNewChat() {
            currentSessionId = Date.now().toString();
            memory = [];
            localStorage.setItem('ansain_current_session', currentSessionId);
            document.getElementById('chatDisplay').innerHTML = '';
            appendUI(`halo bos ${config.name}, sesi baru dimulai. ada yang bisa dibantu?`, 'assistant', false, true);
            toggleSidebar();
        }

        function renderHistoryList() {
            const container = document.getElementById('historyList');
            container.innerHTML = '';
            if(chatSessions.length === 0) {
                container.innerHTML = '<p class="text-[10px] text-white/20 italic">Belum ada obrolan.</p>';
                return;
            }
            [...chatSessions].reverse().forEach(session => {
                const item = document.createElement('div');
                item.className = `history-item ${session.id === currentSessionId ? 'active' : ''}`;
                const title = session.messages.find(m => m.role === 'user')?.content || "Percakapan Baru";
                item.innerHTML = `<p class="text-[11px] font-bold text-white truncate">${title}</p><p class="text-[8px] text-white/30 uppercase mt-1">${new Date(parseInt(session.id)).toLocaleDateString()}</p>`;
                item.onclick = () => loadSession(session.id);
                container.appendChild(item);
            });
        }

        function loadSession(id) {
            const session = chatSessions.find(s => s.id === id);
            if(!session) return;
            currentSessionId = id;
            memory = session.messages;
            localStorage.setItem('ansain_current_session', id);
            document.getElementById('chatDisplay').innerHTML = '';
            memory.forEach(msg => appendUI(msg.content, msg.role, false, false));
            toggleSidebar();
        }

        function saveCurrentSession() {
            if(!currentSessionId) currentSessionId = Date.now().toString();
            const idx = chatSessions.findIndex(s => s.id === currentSessionId);
            if(idx > -1) chatSessions[idx].messages = memory;
            else chatSessions.push({ id: currentSessionId, messages: memory });
            localStorage.setItem('ansain_sessions', JSON.stringify(chatSessions));
        }

        async function loginSystem() {
            const u = document.getElementById('userInputLogin').value.trim();
            const p = document.getElementById('passInputLogin').value.trim();
            const btn = document.getElementById('loginBtn'), err = document.getElementById('loginError');
            if(!u || !p) return;
            btn.disabled = true; btn.innerText = 'VERIFYING...';
            try {
                const res = await fetch('./akses.json');
                const data = await res.json();
                let match = Array.isArray(data) ? data.find(i => i.user === u && i.pw === p) : (data.user === u && data.pw === p ? data : null);
                if(match) {
                    config.name = match.user;
                    localStorage.setItem('ansain_config', JSON.stringify(config));
                    document.getElementById('onboarding').style.display = 'none';
                    document.getElementById('sideUserName').innerText = config.name;
                    if(!currentSessionId) createNewChat(); else loadSession(currentSessionId);
                    setMode(config.mode);
                } else throw new Error();
            } catch {
                err.classList.remove('hidden'); btn.disabled = false; btn.innerText = 'MASUK SISTEM';
            }
        }

        function logout() { if(confirm('Logout?')) { localStorage.clear(); location.reload(); } }
        function clearAllHistory() { if(confirm('Hapus semua histori permanen?')) { chatSessions = []; localStorage.removeItem('ansain_sessions'); createNewChat(); } }

        function toggleMusic() {
            const icon = document.getElementById('playBtnIcon'), disc = document.getElementById('musicIcon');
            if (currentTrack.paused) {
                if (!currentTrack.src || currentTrack.src.includes('null')) playMusic();
                else currentTrack.play().then(() => { icon.className = "fa-solid fa-pause text-[10px]"; disc.classList.add('animate-spin-slow'); });
            } else {
                currentTrack.pause(); icon.className = "fa-solid fa-play text-[10px]"; disc.classList.remove('animate-spin-slow');
            }
        }

        function playMusic() {
            const icon = document.getElementById('playBtnIcon'), disc = document.getElementById('musicIcon');
            let selected = config.mode === 'ngoding' ? ngodingSong : playlist[Math.floor(Math.random() * playlist.length)];
            currentTrack.src = selected.url;
            currentTrack.loop = config.mode === 'ngoding';
            document.getElementById('songTitle').innerText = selected.name.toUpperCase();
            currentTrack.play().then(() => { icon.className = "fa-solid fa-pause text-[10px]"; disc.classList.add('animate-spin-slow'); });
        }

        function setMode(m) {
            document.body.classList.remove('dark-ansain-mode', 'white-ansain-mode');
            if(m === 'dark') document.body.classList.add('dark-ansain-mode');
            if(m === 'white') document.body.classList.add('white-ansain-mode');
            config.mode = m;
            localStorage.setItem('ansain_config', JSON.stringify(config));
            document.getElementById('labelMode').innerText = 'MODE ' + m;
            document.querySelectorAll('.mode-opt').forEach(el => el.classList.remove('active'));
            document.getElementById('m-'+m).classList.add('active');
        }

        function setDarkAnsain() {
            if(config.name.toLowerCase() !== 'dika' && config.name.toLowerCase() !== 'dikz') { alert("OWNER ONLY"); return; }
            setMode('dark');
        }

        function formatResponse(t) {
            const codeRegex = /```([a-z]*)\n([\s\S]*?)```/g;
            return t.replace(codeRegex, (match, lang, code) => {
                const b64 = btoa(unescape(encodeURIComponent(code.trim())));
                return `<div class="code-wrapper"><div class="code-header"><div><i class="fa-solid fa-code"></i><span>${lang || 'code'}</span></div></div><pre><code>${code.trim().replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre><div class="copy-btn-container"><div class="copy-btn" onclick="copyFromBase64('${b64}', this)"><i class="fa-regular fa-copy"></i> COPY</div></div></div>`;
            }).replace(/\n/g, '<br>');
        }

        function copyFromBase64(b64, btn) {
            const text = decodeURIComponent(escape(atob(b64)));
            navigator.clipboard.writeText(text);
            btn.innerHTML = '<i class="fa-solid fa-check text-green-400"></i>';
            setTimeout(() => { btn.innerHTML = '<i class="fa-regular fa-copy"></i> COPY'; }, 2000);
        }

        function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }

        function appendUI(txt, role, save = true, animate = true) {
            const box = document.getElementById('chatDisplay'), bubble = document.createElement('div');
            bubble.className = role === 'user' ? 'bubble-user' : 'bubble-ai';
            box.appendChild(bubble);

            if (role === 'assistant' && animate) {
                isTyping = true;
                let i = 0;
                const speed = 15;
                const formatted = formatResponse(txt);
                
                function type() {
                    if (i < txt.length) {
                        bubble.innerHTML = formatResponse(txt.substring(0, i + 1));
                        box.scrollTo({ top: box.scrollHeight });
                        i++;
                        setTimeout(type, speed);
                    } else {
                        isTyping = false;
                        bubble.innerHTML = formatted;
                        box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
                    }
                }
                type();
            } else {
                bubble.innerHTML = formatResponse(txt);
                box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
            }

            if (save) {
                memory.push({ role, content: txt });
                saveCurrentSession();
            }
        }

        async function handleProcess() {
            if (isTyping) return;
            const input = document.getElementById('userInput'), query = input.value.trim();
            if(!query) return;
            appendUI(query, 'user'); input.value = ''; input.style.height = 'auto';
            document.getElementById('typingIndicator').classList.remove('hidden');
            let sys = `kamu ansain ai buatan dika. gaya lowercase, santai, panggil bos. dilarang pakai // di kode. mode: ${config.mode}`;
            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST", headers: { "Authorization": "Bearer " + keys[Math.floor(Math.random()*keys.length)], "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: [{ role: "system", content: sys }, ...memory.slice(-20)] })
                });
                const data = await res.json();
                document.getElementById('typingIndicator').classList.add('hidden');
                appendUI(data.choices[0].message.content, 'assistant');
            } catch { document.getElementById('typingIndicator').classList.add('hidden'); appendUI("error.", 'assistant'); }
        }

        document.getElementById('userInput').addEventListener("keydown", e => { 
            if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); handleProcess(); } 
        });

        window.onload = () => { 
            if(config.name) { 
                document.getElementById('onboarding').style.display = 'none'; 
                document.getElementById('sideUserName').innerText = config.name;
                setMode(config.mode);
                if(currentSessionId) loadSession(currentSessionId); else createNewChat();
            } else document.getElementById('onboarding').style.display = 'flex';
        };
    </script>
</body>
</html>
