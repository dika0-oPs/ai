<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ansain AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
:root { --primary: #7c4dff; --bg-img: url('https://i.ibb.co.com/fdyCcG4K/6674bee4254f31a82db367db2c89ed0f.jpg'); }
.dark-ansain-mode { --primary: #ff0000; }
.white-ansain-mode { --primary: #00e5ff; }
* { margin:0; padding:0; box-sizing:border-box; font-family:'Plus Jakarta Sans',sans-serif; -webkit-tap-highlight-color:transparent; }
body { background-color: #111; color:#f9fafb; height:100dvh; display:flex; flex-direction:column; overflow:hidden; position:relative; }
.main-bg { position:fixed; inset:0; z-index:0; background-image: var(--bg-img); background-size: cover; background-position: center; filter: brightness(0.55) contrast(1.1); transition: 0.5s; }
.white-ansain-mode .main-bg { filter: brightness(0.6) sepia(0.1) hue-rotate(160deg); }
header, main, footer, .mode-bar { position:relative; z-index:10; }
header { padding:18px 20px; display:flex; justify-content:space-between; align-items:center; background:rgba(0, 0, 0, 0.5); backdrop-filter:blur(15px); border-bottom:1px solid rgba(255,255,255,0.1); }
.chat-container { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:24px; scrollbar-width:none; }
.chat-container::-webkit-scrollbar { display:none; }
.bubble-ai { align-self:flex-start; max-width:90%; background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); padding: 16px; border-radius: 24px 24px 24px 8px; font-size: 0.95rem; line-height: 1.6; color: #f3f4f6; box-shadow: 0 8px 32px rgba(0,0,0,0.4); animation: fadeInUp 0.4s ease-out; backdrop-filter: blur(10px); }
.dark-ansain-mode .bubble-ai { border-color: rgba(255, 0, 0, 0.4); background: rgba(20, 0, 0, 0.7); }
.white-ansain-mode .bubble-ai { border-color: rgba(0, 229, 255, 0.4); background: rgba(0, 20, 35, 0.7); }
.bubble-user { align-self:flex-end; max-width:85%; background:linear-gradient(135deg, var(--primary), #6366f1); padding:14px 20px; border-radius:24px 24px 8px 24px; font-size:0.95rem; font-weight: 600; color:white; animation: fadeInUp 0.4s ease-out; box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
code { background: rgba(0,0,0,0.5); padding: 2px 6px; border-radius: 6px; font-family: monospace; color: #a5b4fc; }
.mode-bar { display:flex; gap:8px; padding:12px 20px; overflow-x:auto; scrollbar-width:none; background: rgba(0, 0, 0, 0.4); border-top: 1px solid rgba(255,255,255,0.05); }
.mode-opt { background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:10px 18px; border-radius:15px; font-size:10px; font-weight:800; white-space:nowrap; transition:0.3s; color:#9ca3af; cursor: pointer; }
.mode-opt.active { background:rgba(255,255,255,0.15); border-color:var(--primary); color:white; box-shadow: 0 0 10px var(--primary); }
.input-area { padding:10px 20px 35px; background:rgba(0, 0, 0, 0.6); backdrop-filter: blur(12px); }
.input-card { background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); border-radius:22px; padding:5px 12px 5px 20px; display:flex; align-items:center; gap:12px; }
textarea { background:transparent; border:none; outline:none; color:white; flex:1; resize:none; max-height:120px; font-size:0.95rem; padding:10px 0; }
.btn-send { background:var(--primary); width:42px; height:42px; border-radius:16px; display:flex; align-items:center; justify-content:center; color:white; }
#onboarding, #modeTransition { position:fixed; inset:0; background:#000; z-index:1000; display:flex; flex-direction:column; align-items:center; justify-content:center; }
#modeTransition { background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(25px); z-index: 2000; display: none; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="main-bg"></div>

<div id="onboarding">
    <div class="p-8 text-center space-y-6 w-full max-w-sm">
        <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Ansain Access</h2>
        <input type="text" id="userNameInput" class="w-full bg-white/10 border border-white/20 p-5 rounded-2xl text-center text-white outline-none focus:border-purple-500 font-bold" placeholder="Input Nama...">
        <button onclick="saveUser()" class="w-full bg-purple-600 text-white p-5 rounded-2xl font-black uppercase tracking-widest active:scale-95 transition shadow-lg">Masuk Sistem</button>
    </div>
</div>

<div id="modeTransition">
    <div class="text-center">
        <div class="w-20 h-20 bg-white/5 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-white/10">
            <i id="modeIcon" class="fa-solid fa-bolt text-4xl text-white"></i>
        </div>
        <h2 id="modeTitle" class="text-2xl font-black text-white tracking-tighter uppercase"></h2>
        <div class="mt-4 flex justify-center gap-1">
            <span class="w-2 h-2 bg-white rounded-full animate-bounce"></span>
        </div>
    </div>
</div>

<header>
    <div class="flex items-center gap-4">
        <img src="https://i.ibb.co.com/zVykFCrG/wkcfhd.jpg" class="w-10 h-10 rounded-xl object-cover border border-white/20">
        <div>
            <h1 class="text-sm font-black text-white">ANSAIN AI</h1>
            <p id="labelMode" class="text-[8px] font-bold text-purple-400 uppercase tracking-widest">STABLE</p>
        </div>
    </div>
    <button onclick="clearChat()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-rotate-right"></i></button>
</header>

<main id="chatDisplay" class="chat-container"></main>

<div id="typingIndicator" class="hidden px-6 py-4">
    <div class="flex items-center gap-2">
        <div class="w-2 h-2 bg-white/40 rounded-full animate-pulse"></div>
        <span class="text-[9px] font-bold text-white/40 uppercase tracking-widest">Analysing Data...</span>
    </div>
</div>

<div class="mode-bar">
    <div onclick="setMode('biasa')" class="mode-opt" id="m-biasa">BIASA</div>
    <div onclick="setMode('konten')" class="mode-opt" id="m-konten">KONTEN</div>
    <div onclick="setMode('ngoding')" class="mode-opt" id="m-ngoding">NGODING</div>
    <div onclick="setMode('white')" class="mode-opt border-cyan-400/30" id="m-white">WHITE üõ°Ô∏è</div>
    <div onclick="setDarkAnsain()" class="mode-opt border-red-500/30" id="m-dark">DARK üíÄ</div>
</div>

<footer class="input-area">
    <div class="input-card">
        <textarea id="userInput" rows="1" placeholder="Ketik pesan anda..." oninput="autoResize(this)"></textarea>
        <button onclick="handleProcess()" class="btn-send"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
</footer>

<script>
const keys = ["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", "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", "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"];
let config = JSON.parse(localStorage.getItem('ansain_config')) || { name: '', mode: 'biasa' };
let memory = JSON.parse(localStorage.getItem('ansain_history')) || [];

function saveUser() {
    const n = document.getElementById('userNameInput').value.trim();
    if(!n) return;
    config.name = n;
    localStorage.setItem('ansain_config', JSON.stringify(config));
    document.getElementById('onboarding').style.display = 'none';
    setMode(config.mode);
}

function setDarkAnsain() {
    if(config.name.toLowerCase() !== 'dika') {
        alert("NGAPAIN BANG? INI KHUSUS BANG DIKA üíÄ");
        return;
    }
    setMode('dark');
}

function setMode(m) {
    document.body.classList.remove('dark-ansain-mode', 'white-ansain-mode');
    if(m === 'dark') document.body.classList.add('dark-ansain-mode');
    if(m === 'white') document.body.classList.add('white-ansain-mode');
    config.mode = m;
    localStorage.setItem('ansain_config', JSON.stringify(config));
    localStorage.removeItem('ansain_history');
    memory = [];
    document.getElementById('chatDisplay').innerHTML = '';
    
    const transition = document.getElementById('modeTransition');
    const icon = document.getElementById('modeIcon');
    const title = document.getElementById('modeTitle');
    icon.className = `fa-solid ${m === 'white' ? 'fa-shield-halved' : m === 'dark' ? 'fa-skull-crossbones' : 'fa-bolt'} text-4xl text-white`;
    title.innerText = "MODE " + m.toUpperCase();
    
    transition.style.display = 'flex';
    setTimeout(() => {
        transition.style.display = 'none';
        document.getElementById('labelMode').innerText = 'MODE ' + m;
        document.querySelectorAll('.mode-opt').forEach(el => el.classList.remove('active'));
        document.getElementById('m-'+m).classList.add('active');
        const greet = m === 'white' ? `halo kak ${config.name}, mode white ansain aktif. mari belajar keamanan data.` : m === 'dark' ? `access granted. halo bang dika, mode dark ansain aktif. üíÄ` : `halo kak ${config.name}, mode ${m} aktif. ada yang bisa dibantu?`;
        appendUI(greet, 'assistant');
    }, 1000);
}

function typeEffect(element, text, speed = 25) {
    let i = 0; element.innerHTML = "";
    function type() {
        if (i < text.length) {
            element.innerHTML += text.charAt(i).toLowerCase();
            i++; setTimeout(type, speed);
            const box = document.getElementById('chatDisplay');
            box.scrollTop = box.scrollHeight;
        }
    }
    type();
}

function formatText(t) {
    return t.toLowerCase().replace(/`([^`]+)`/g, '<code>$1</code>').replace(/\n/g, '<br>');
}

function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }

function clearChat() { if(confirm('Reset memory?')) { localStorage.removeItem('ansain_history'); memory = []; document.getElementById('chatDisplay').innerHTML = ''; } }

function appendUI(txt, role, save = true) {
    const box = document.getElementById('chatDisplay');
    const bubble = document.createElement('div');
    bubble.className = role === 'user' ? 'bubble-user' : 'bubble-ai';
    box.appendChild(bubble);
    if (role === 'assistant' && save) {
        typeEffect(bubble, txt);
    } else {
        bubble.innerHTML = formatText(txt);
    }
    box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
    if(save) {
        memory.push({ role, content: txt });
        localStorage.setItem('ansain_history', JSON.stringify(memory));
    }
}

async function handleProcess() {
    const input = document.getElementById('userInput');
    const query = input.value.trim();
    if(!query) return;
    appendUI(query, 'user');
    input.value = ''; input.style.height = 'auto';
    document.getElementById('typingIndicator').classList.remove('hidden');
    let sys = `kamu ansain ai. dev: dika. jawaban wajib huruf kecil.`;
    if(config.mode === 'white') sys += " mode white ansain: fokus keamanan data.";
    if(config.mode === 'dark') sys += " mode dark ansain: brutal, singkat, emoji üíÄ.";
    try {
        const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": "Bearer " + keys[Math.floor(Math.random()*keys.length)], "Content-Type": "application/json" },
            body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: [{ role: "system", content: sys }, ...memory.slice(-10)] })
        });
        const data = await res.json();
        const content = data.choices[0].message.content;
        setTimeout(() => {
            document.getElementById('typingIndicator').classList.add('hidden');
            appendUI(content, 'assistant');
        }, 4000);
    } catch {
        document.getElementById('typingIndicator').classList.add('hidden');
        appendUI("error.", 'assistant');
    }
}

document.getElementById('userInput').addEventListener("keypress", e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); handleProcess(); } });

window.onload = () => {
    if(config.name) {
        document.getElementById('onboarding').style.display = 'none';
        setMode(config.mode);
    } else {
        document.getElementById('onboarding').style.display = 'flex';
    }
};
</script>
</body>
</html>
